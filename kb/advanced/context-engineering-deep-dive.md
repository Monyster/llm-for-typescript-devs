# KB: Context Engineering ‚Äî –ü–æ–≤–Ω–∏–π –¥–æ–≤—ñ–¥–Ω–∏–∫

> üìö –§—É–Ω–¥–∞–º–µ–Ω—Ç: [Course ‚Äî Context Engineering](../../course/context-engineering.md) —Ç–∞ [Course ‚Äî –ü—Ä–æ–º–ø—Ç-—ñ–Ω–∂–µ–Ω–µ—Ä—ñ—è](../../course/04-prompting.md)

## –ö–æ–ª–∏ —Ü–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ

- –í–∞—à AI-–∞–≥–µ–Ω—Ç "–≥–∞–ª—é—Ü–∏–Ω—É—î" –∞–±–æ –¥–∞—î –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ–ø—Ä–∏ —Ö–æ—Ä–æ—à–∏–π –ø—Ä–æ–º–ø—Ç
- –Ø–∫—ñ—Å—Ç—å –ø–∞–¥–∞—î –∑—ñ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è–º —Ä–æ–∑–º–æ–≤–∏ (context pollution)
- –ê–≥–µ–Ω—Ç –æ–±–∏—Ä–∞—î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –∞–±–æ –∑–∞—Ü–∏–∫–ª—é—î—Ç—å—Å—è
- –ü–æ—Ç—Ä—ñ–±–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç—É–≤–∞—Ç–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É AI-—Å–∏—Å—Ç–µ–º–∏ –¥–ª—è production
- –ì–æ—Ç—É—î—Ç–µ—Å—å –¥–æ —Ç–µ—Ö–Ω—ñ—á–Ω–æ—ó —Ä–æ–∑–º–æ–≤–∏ –∞–±–æ —Å–ø—ñ–≤–±–µ—Å—ñ–¥–∏ ‚Äî context engineering —î –∫–ª—é—á–æ–≤–∏–º —Ç–µ—Ä–º—ñ–Ω–æ–º 2025‚Äì2026

---

## Quick Reference

```
Context = System Prompt + Tools + Retrieved Data + History + User Query

–ü—Ä–∏–Ω—Ü–∏–ø–∏:
1. –ú–µ–Ω—à–µ = –∫—Ä–∞—â–µ (–º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –Ω–∞–±—ñ—Ä –≤–∏—Å–æ–∫–æ—Å–∏–≥–Ω–∞–ª—å–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤)
2. Just in Time (–ø—ñ–¥—Ç—è–≥—É–π –¥–∞–Ω—ñ –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –Ω–µ –Ω–∞–ø–µ—Ä–µ–¥)
3. Budget (–∫–æ–Ω—Ç—Ä–æ–ª—é–π —Å–∫—ñ–ª—å–∫–∏ —Ç–æ–∫–µ–Ω—ñ–≤ –∑–∞–π–º–∞—î –∫–æ–∂–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
4. Compaction (—Å—Ç–∏—Å–∫–∞–π –¥–æ–≤–≥—ñ —Ä–æ–∑–º–æ–≤–∏, –Ω–µ —Ç—Ä–∏–º–∞–π –≤—Å–µ)
5. Separation (—Ä–æ–∑–¥—ñ–ª—è–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –º—ñ–∂ sub-agents)
```

---

## –¢–µ—Ä–º—ñ–Ω–æ–ª–æ–≥—ñ—è

| –¢–µ—Ä–º—ñ–Ω | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|-----------|
| **Context Window** | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–∫–µ–Ω—ñ–≤ —è–∫—É –º–æ–¥–µ–ª—å –º–æ–∂–µ –æ–±—Ä–æ–±–∏—Ç–∏ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø–∏—Ç (128K‚Äì2M –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –º–æ–¥–µ–ª—ñ) |
| **Context Engineering** | –î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —Ç–æ–≥–æ, –©–û –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ context window –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–∂–∞–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –º–æ–¥–µ–ª—ñ |
| **Context Pollution** | –î–µ–≥—Ä–∞–¥–∞—Ü—ñ—è —è–∫–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ –Ω–∞–¥–ª–∏—à–æ–∫ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ |
| **Context Rot** | –ü–æ—Å—Ç—É–ø–æ–≤–µ –ø–æ–≥—ñ—Ä—à–µ–Ω–Ω—è —É–≤–∞–≥–∏ –º–æ–¥–µ–ª—ñ –¥–æ –¥–µ—Ç–∞–ª–µ–π –∑—ñ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è–º –∫–æ–Ω—Ç–µ–∫—Å—Ç—É |
| **Compaction** | –°—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É (summarization) –∑—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º –∫–ª—é—á–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó |
| **Just-in-Time Context** | –ü—ñ–¥—Ö—ñ–¥ –¥–µ –ø–æ–≤–Ω—ñ –¥–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –≤ –º–æ–º–µ–Ω—Ç –ø–æ—Ç—Ä–µ–±–∏, –∞ –Ω–µ –Ω–∞–ø–µ—Ä–µ–¥ |
| **Dynamic Context Injection** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∫–ª—é—á–µ–Ω–Ω—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Ç–æ–º |
| **Token Budget** | –°–≤—ñ–¥–æ–º–µ –æ–±–º–µ–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –Ω–∞ –∫–æ–∂–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—É |
| **"Dumb Zone"** | –ó–æ–Ω–∞ –¥–µ–≥—Ä–∞–¥–∞—Ü—ñ—ó (~40%+ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ) –¥–µ —è–∫—ñ—Å—Ç—å –ø–æ–º—ñ—Ç–Ω–æ –ø–∞–¥–∞—î (Dex Horthy, 12 Factor Agents) |

---

## –•—Ä–æ–Ω–æ–ª–æ–≥—ñ—è: –≤—ñ–¥ Prompt Engineering –¥–æ Context Engineering

```
2022‚Äì2023: Prompt Engineering
  –§–æ–∫—É—Å –Ω–∞ –º–∞–≥—ñ—á–Ω–∏—Ö —Ñ–æ—Ä–º—É–ª—é–≤–∞–Ω–Ω—è—Ö, "hack the AI" –ø—ñ–¥—Ö—ñ–¥
  Zero-shot, few-shot, chain-of-thought

2024: RAG + Tool Use —Å—Ç–∞—é—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º
  –ö–æ–Ω—Ç–µ–∫—Å—Ç = –ø—Ä–æ–º–ø—Ç + –¥–æ–∫—É–º–µ–Ω—Ç–∏ + —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
  –ê–ª–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ü–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º ‚Äî ad hoc

–ß–µ—Ä–≤–µ–Ω—å 2025: –¢–µ—Ä–º—ñ–Ω –∑–∞–∫—Ä—ñ–ø–ª—é—î—Ç—å—Å—è
  Tobi L√ºtke (CEO Shopify) —ñ Andrej Karpathy (ex-OpenAI) 
  –ø—É–±–ª—ñ—á–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å —Ç–µ—Ä–º—ñ–Ω "context engineering"

–í–µ—Ä–µ—Å–µ–Ω—å 2025: Anthropic –ø—É–±–ª—ñ–∫—É—î
  "Effective context engineering for AI agents"
  –§–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏ —Ä–∞–∑–æ–º –∑ Claude Sonnet 4.5

–ñ–æ–≤—Ç–µ–Ω—å 2025: Gartner
  "Context engineering is replacing prompt engineering 
   for enterprise AI success"

2026: Context engineering = –±–∞–∑–æ–≤–∞ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü—ñ—è
  57% –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π –º–∞—é—Ç—å AI-–∞–≥–µ–Ω—Ç—ñ–≤ –≤ production (LangChain)
  32% –Ω–∞–∑–∏–≤–∞—é—Ç—å —è–∫—ñ—Å—Ç—å –≥–æ–ª–æ–≤–Ω–æ—é –ø—Ä–æ–±–ª–µ–º–æ—é ‚Äî –ø–µ—Ä–µ–≤–∞–∂–Ω–æ —á–µ—Ä–µ–∑ context
```

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É: –¥–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑–±—ñ—Ä

### 1. System Prompt Design

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ system prompt:**

```typescript
const systemPrompt = `
# –†–æ–ª—å
–¢–∏ ‚Äî [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —Ä–æ–ª—å] –¥–ª—è [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –∫–æ–º–ø–∞–Ω—ñ—è/–ø—Ä–æ–¥—É–∫—Ç].

# –ü—Ä–∞–≤–∏–ª–∞ (–û–ë–û–í'–Ø–ó–ö–û–í–Ü)
- [–ü—Ä–∞–≤–∏–ª–æ 1 ‚Äî —â–æ –ó–ê–í–ñ–î–ò —Ä–æ–±–∏—Ç–∏]
- [–ü—Ä–∞–≤–∏–ª–æ 2 ‚Äî —â–æ –ù–Ü–ö–û–õ–ò –Ω–µ —Ä–æ–±–∏—Ç–∏]
- [–ü—Ä–∞–≤–∏–ª–æ 3 ‚Äî –∫–æ–ª–∏ –µ—Å–∫–∞–ª—é–≤–∞—Ç–∏]

# –§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- [–¢–æ–Ω: —Ñ–æ—Ä–º–∞–ª—å–Ω–∏–π/–¥—Ä—É–∂–Ω—ñ–π]
- [–ú–æ–≤–∞: —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞]
- [–î–æ–≤–∂–∏–Ω–∞: –º–∞–∫—Å–∏–º—É–º N —Ä–µ—á–µ–Ω—å]

# –û–±—Ä–æ–±–∫–∞ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω–æ—Å—Ç—ñ
- –Ø–∫—â–æ –Ω–µ–º–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó ‚Üí "–ù–µ –º–∞—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ —Ü—å–æ–≥–æ –ø–∏—Ç–∞–Ω–Ω—è"
- –Ø–∫—â–æ –ø–æ–∑–∞ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü—ñ—î—é ‚Üí –µ—Å–∫–∞–ª—é–≤–∞—Ç–∏
- –ù—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–≥–∞–¥—É–≤–∞—Ç–∏ —Ñ–∞–∫—Ç–∏
`;
```

**–ê–Ω—Ç–∏–ø–∞—Ç–µ—Ä–Ω–∏ system prompt:**
- –°–ø–∏—Å–æ–∫ –∑ 50+ –ø—Ä–∞–≤–∏–ª (–º–æ–¥–µ–ª—å —ñ–≥–Ω–æ—Ä—É—î –±—ñ–ª—å—à—ñ—Å—Ç—å)
- –°—É–ø–µ—Ä–µ—á–ª–∏–≤—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
- –ù–∞–¥–º—ñ—Ä–Ω–∞ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è edge cases –∑–∞–º—ñ—Å—Ç—å –∑–∞–≥–∞–ª—å–Ω–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤
- –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –≤–∏–ø–∞–¥–∫—É –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω–æ—Å—Ç—ñ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è Anthropic:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ few-shot –ø—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–º—ñ—Å—Ç—å —Å–ø–∏—Å–∫—É –ø—Ä–∞–≤–∏–ª. –í–∫–ª—é—á–∞–π—Ç–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ (—â–æ –ù–ï —Ä–æ–±–∏—Ç–∏) ‚Äî –≤–æ–Ω–∏ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å –º–µ–∂—ñ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏.

### 2. Tool Design

**–ü—Ä–∏–Ω—Ü–∏–ø–∏ –≤—ñ–¥ Anthropic:**

```typescript
// ‚úÖ –î–û–ë–†–ï: –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –Ω–∞–±—ñ—Ä –∑ —á—ñ—Ç–∫–∏–º–∏ –∑–æ–Ω–∞–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ
const tools = {
  // –ö–æ–∂–µ–Ω tool –º–∞—î –û–î–ù–£ —á—ñ—Ç–∫—É –∑–∞–¥–∞—á—É
  searchProducts: tool({
    description: '–®—É–∫–∞—î —Ç–æ–≤–∞—Ä–∏ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ –∑–∞ –Ω–∞–∑–≤–æ—é –∞–±–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é. –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ.',
    parameters: z.object({
      query: z.string(),
      category: z.enum(['electronics', 'clothing', 'home']).optional(),
    }),
    execute: async ({ query, category }) => { /* ... */ },
  }),
  
  checkAvailability: tool({
    description: '–ü–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É –∑–∞ –π–æ–≥–æ ID. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ü–Ü–°–õ–Ø searchProducts.',
    parameters: z.object({
      productId: z.string().describe('ID —Ç–æ–≤–∞—Ä—É –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ searchProducts'),
    }),
    execute: async ({ productId }) => { /* ... */ },
  }),
};

// ‚ùå –ü–û–ì–ê–ù–û: –æ–¥–∏–Ω "god tool" —â–æ —Ä–æ–±–∏—Ç—å –≤—Å–µ
const tools = {
  doEverything: tool({
    description: '–®—É–∫–∞—î —Ç–æ–≤–∞—Ä–∏, –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å, –æ—Ñ–æ—Ä–º–ª—è—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ç–∞—Ç—É—Å',
    parameters: z.object({
      action: z.enum(['search', 'check', 'order', 'status']),
      query: z.string().optional(),
      productId: z.string().optional(),
      orderId: z.string().optional(),
    }),
    execute: async (params) => { /* –≥—ñ–≥–∞–Ω—Ç—Å—å–∫–∏–π switch */ },
  }),
};
```

**–ü—Ä–∞–≤–∏–ª–æ Anthropic:** –Ø–∫—â–æ –ª—é–¥–∏–Ω–∞-—ñ–Ω–∂–µ–Ω–µ—Ä –Ω–µ –º–æ–∂–µ –º–∏—Ç—Ç—î–≤–æ —ñ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —è–∫–∏–π tool –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ–π —Å–∏—Ç—É–∞—Ü—ñ—ó ‚Äî –º–æ–¥–µ–ª—å —Ç–µ–∂ –Ω–µ –∑–º–æ–∂–µ.

**Token-–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å tools:**

```typescript
// ‚ùå Tool –ø–æ–≤–µ—Ä—Ç–∞—î –∑–∞–±–∞–≥–∞—Ç–æ –¥–∞–Ω–∏—Ö
execute: async ({ query }) => {
  const results = await db.query(query);
  return JSON.stringify(results); // 50 –∑–∞–ø–∏—Å—ñ–≤ √ó 20 –ø–æ–ª—ñ–≤ = —Ç–∏—Å—è—á—ñ —Ç–æ–∫–µ–Ω—ñ–≤
}

// ‚úÖ Tool –ø–æ–≤–µ—Ä—Ç–∞—î —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω–µ
execute: async ({ query }) => {
  const results = await db.query(query);
  return results.slice(0, 5).map(r => ({
    id: r.id,
    name: r.name,
    status: r.status,
  }));
}
```

### 3. Retrieved Data (RAG Context)

**–¢—Ä–∏ –ø–æ–∫–æ–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –¥–∞–Ω–∏—Ö:**

```
2024: Static RAG
  Embed query ‚Üí top-K chunks ‚Üí pass to LLM
  –ü—Ä–æ–±–ª–µ–º–∞: –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ chunks –∑–∞–±—Ä—É–¥–Ω—é—é—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç

2025: Dynamic RAG
  Query decomposition ‚Üí targeted retrieval ‚Üí re-ranking ‚Üí filtered top-K
  –ö—Ä–∞—â–µ, –∞–ª–µ –≤—Å–µ —â–µ pre-inference

2026: Just-in-Time Context
  Agent —Ç—Ä–∏–º–∞—î –Ü–î–ï–ù–¢–ò–§–Ü–ö–ê–¢–û–†–ò (file paths, IDs, URLs)
  –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –ø–æ–≤–Ω—ñ –¥–∞–Ω—ñ –¢–Ü–õ–¨–ö–ò –∫–æ–ª–∏ –≤–∏—Ä—ñ—à—É—î —â–æ –≤–æ–Ω–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ
  –ß–µ—Ä–µ–∑ tool calls, –≤ –º–æ–º–µ–Ω—Ç –ø–æ—Ç—Ä–µ–±–∏
```

```typescript
// Just-in-Time –ø—ñ–¥—Ö—ñ–¥
const tools = {
  // Agent —Å–ø–æ—á–∞—Ç–∫—É —à—É–∫–∞—î –Ü–î–ï–ù–¢–ò–§–Ü–ö–ê–¢–û–†–ò
  listDocuments: tool({
    description: '–ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –æ–ø–∏—Å–∞–º–∏ (–±–µ–∑ –ø–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É)',
    parameters: z.object({ query: z.string() }),
    execute: async ({ query }) => {
      const docs = await searchDocuments(query);
      return docs.map(d => ({ 
        id: d.id, 
        title: d.title, 
        snippet: d.content.slice(0, 100) // —Ç—ñ–ª—å–∫–∏ –ø–µ—Ä—à—ñ 100 —Å–∏–º–≤–æ–ª—ñ–≤
      }));
    },
  }),
  
  // –Ü –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—î –ø–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç –¢–Ü–õ–¨–ö–ò –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ
  readDocument: tool({
    description: '–ü–æ–≤–µ—Ä—Ç–∞—î –ø–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∑–∞ ID',
    parameters: z.object({ documentId: z.string() }),
    execute: async ({ documentId }) => {
      const doc = await getDocument(documentId);
      return { title: doc.title, content: doc.content };
    },
  }),
};
```

### 4. Conversation History Management

**–°—Ç—Ä–∞—Ç–µ–≥—ñ—ó —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—î—é:**

```typescript
// –°—Ç—Ä–∞—Ç–µ–≥—ñ—è 1: Sliding Window
function slidingWindow(messages: Message[], maxMessages: number = 20): Message[] {
  if (messages.length <= maxMessages) return messages;
  return messages.slice(-maxMessages);
}

// –°—Ç—Ä–∞—Ç–µ–≥—ñ—è 2: Summarize + Recent
async function summarizeAndKeepRecent(
  messages: Message[],
  recentCount: number = 10
): Promise<Message[]> {
  if (messages.length <= recentCount) return messages;
  
  const oldMessages = messages.slice(0, -recentCount);
  const recentMessages = messages.slice(-recentCount);
  
  const { text: summary } = await generateText({
    model: openai('gpt-4o-mini'),
    system: `–°—Ç–≤–æ—Ä–∏ —Å—Ç–∏—Å–ª–µ —Ä–µ–∑—é–º–µ —Ä–æ–∑–º–æ–≤–∏. –ó–±–µ—Ä–µ–∂–∏:
- –ö–ª—é—á–æ–≤—ñ —Ñ–∞–∫—Ç–∏ (—ñ–º–µ–Ω–∞, –Ω–æ–º–µ—Ä–∏, –¥–∞—Ç–∏)
- –ü—Ä–∏–π–Ω—è—Ç—ñ —Ä—ñ—à–µ–Ω–Ω—è
- –í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è
–ú–∞–∫—Å–∏–º—É–º 500 —Å–ª—ñ–≤.`,
    prompt: oldMessages.map(m => `${m.role}: ${m.content}`).join('\n'),
  });
  
  return [
    { role: 'system', content: `–†–µ–∑—é–º–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —Ä–æ–∑–º–æ–≤–∏:\n${summary}` },
    ...recentMessages,
  ];
}

// –°—Ç—Ä–∞—Ç–µ–≥—ñ—è 3: Structured Notes (Anthropic approach)
// –ê–≥–µ–Ω—Ç –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–Ω–∞—á–Ω–æ–≥–æ –∫—Ä–æ–∫—É –ø–∏—à–µ –Ω–æ—Ç–∞—Ç–∫—É
// –ù–∞ –ø–æ—á–∞—Ç–∫—É –Ω–æ–≤–æ—ó —Å–µ—Å—ñ—ó ‚Äî —á–∏—Ç–∞—î –Ω–æ—Ç–∞—Ç–∫–∏ –∑–∞–º—ñ—Å—Ç—å –ø–æ–≤–Ω–æ—ó —ñ—Å—Ç–æ—Ä—ñ—ó
async function structuredNotes(
  conversationId: string
): Promise<string> {
  const notes = await db.getNotes(conversationId);
  return notes.map(n => `[${n.timestamp}] ${n.content}`).join('\n');
}
```

**–ö–æ–ª–∏ —è–∫—É —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é:**

| –°—Ç—Ä–∞—Ç–µ–≥—ñ—è | –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ | –í–∞—Ä—Ç—ñ—Å—Ç—å |
|-----------|---------------------|---------|
| Sliding window | –ü—Ä–æ—Å—Ç—ñ —á–∞—Ç–±–æ—Ç–∏, short-lived —Ä–æ–∑–º–æ–≤–∏ | –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ |
| Summarize + Recent | –¢—Ä–∏–≤–∞–ª—ñ —Ä–æ–∑–º–æ–≤–∏ –∑ –≤–∞–∂–ª–∏–≤–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º | 1 –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π LLM-–≤–∏–∫–ª–∏–∫ |
| Structured notes | –ê–≥–µ–Ω—Ç–∏ —â–æ –ø—Ä–∞—Ü—é—é—Ç—å —á–µ—Ä–µ–∑ –∫—ñ–ª—å–∫–∞ —Å–µ—Å—ñ–π/–¥–Ω—ñ–≤ | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ (file I/O) |
| Multi-agent | –°–∫–ª–∞–¥–Ω—ñ –¥–æ—Å–ª—ñ–¥–Ω–∏—Ü—å–∫—ñ –∑–∞–¥–∞—á—ñ | –ö—ñ–ª—å–∫–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö LLM-–≤–∏–∫–ª–∏–∫—ñ–≤ |

---

## Compaction: –¥–µ—Ç–∞–ª—å–Ω–∏–π –ø–∞—Ç–µ—Ä–Ω

Compaction ‚Äî —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞ Anthropic –¥–ª—è –¥–æ–≤–≥–æ–∂–∏–≤—É—á–∏—Ö –∞–≥–µ–Ω—Ç—ñ–≤.

```typescript
interface CompactionConfig {
  maxContextTokens: number;     // –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω—ñ–≤ –ø–µ—Ä–µ–¥ compaction
  compactionThreshold: number;  // –ü—Ä–∏ —è–∫–æ–º—É % –∑–∞–ø—É—Å–∫–∞—Ç–∏ (–∑–∞–∑–≤–∏—á–∞–π 70-80%)
  preserveRecentMessages: number; // –°–∫—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑–∞–ª–∏—à–∏—Ç–∏ –±–µ–∑ –∑–º—ñ–Ω
  compactionModel: string;      // –Ø–∫—É –º–æ–¥–µ–ª—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ (–¥–µ—à–µ–≤—É)
}

async function maybeCompact(
  messages: Message[],
  config: CompactionConfig
): Promise<Message[]> {
  const currentTokens = estimateTokens(JSON.stringify(messages));
  const threshold = config.maxContextTokens * (config.compactionThreshold / 100);
  
  if (currentTokens < threshold) return messages;
  
  console.log(`Context at ${currentTokens} tokens, compacting...`);
  
  const toCompact = messages.slice(0, -config.preserveRecentMessages);
  const toPreserve = messages.slice(-config.preserveRecentMessages);
  
  const { text: compacted } = await generateText({
    model: openai(config.compactionModel),
    system: `–°—Ç–∏—Å–Ω–∏ —Ü—é —Ä–æ–∑–º–æ–≤—É –¥–æ –∫–ª—é—á–æ–≤–∏—Ö —Ñ–∞–∫—Ç—ñ–≤. –ó–±–µ—Ä–µ–∂–∏:
1. –í—Å—ñ —Ñ–∞–∫—Ç–∏ (—ñ–º–µ–Ω–∞, —á–∏—Å–ª–∞, ID, –¥–∞—Ç–∏)
2. –†—ñ—à–µ–Ω–Ω—è —è–∫—ñ –ø—Ä–∏–π–Ω—è—Ç—ñ
3. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ tool calls (–∫–æ—Ä–æ—Ç–∫–æ)
4. –í—ñ–¥–∫—Ä–∏—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–¥–∞—á—ñ –≤ –ø—Ä–æ—Ü–µ—Å—ñ

–ù–ï –≤–∫–ª—é—á–∞–π: –∑–∞–≥–∞–ª—å–Ω—ñ —Ñ—Ä–∞–∑–∏, –ø–æ–≤—Ç–æ—Ä–∏, tool call –ø–∞—Ä–∞–º–µ—Ç—Ä–∏.
–§–æ—Ä–º–∞—Ç: —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫.`,
    prompt: JSON.stringify(toCompact),
  });
  
  return [
    { role: 'system', content: `[Compacted context]\n${compacted}` },
    ...toPreserve,
  ];
}
```

---

## Multi-Agent Context Separation

–ö–æ–ª–∏ –æ–¥–Ω–æ–º—É –∞–≥–µ–Ω—Ç—É –∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É ‚Äî —Ä–æ–∑–¥—ñ–ª—è—î–º–æ –Ω–∞ –∫—ñ–ª—å–∫–æ—Ö.

```typescript
import { generateText, tool } from 'ai';
import { openai } from '@ai-sdk/openai';

// Lead agent ‚Äî —Ç—Ä–∏–º–∞—î –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
async function leadAgent(query: string) {
  return await generateText({
    model: openai('gpt-4o'),
    system: `–¢–∏ ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä. –†–æ–∑–±–∏–π –∑–∞–ø–∏—Ç –Ω–∞ –ø—ñ–¥–∑–∞–¥–∞—á—ñ —Ç–∞ –¥–µ–ª–µ–≥—É–π sub-–∞–≥–µ–Ω—Ç–∞–º.
–ù–µ –Ω–∞–º–∞–≥–∞–π—Å—è –≤–∏—Ä—ñ—à–∏—Ç–∏ –≤—Å–µ —Å–∞–º ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏.`,
    prompt: query,
    tools: {
      // Sub-agent –¥–ª—è –ø–æ—à—É–∫—É ‚Äî –º–∞—î –°–í–Ü–ô –æ–∫—Ä–µ–º–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
      researchAgent: tool({
        description: '–î–æ—Å–ª—ñ–¥–∂—É—î —Ç–µ–º—É. –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∏—Å–ª–∏–π –∑–≤—ñ—Ç.',
        parameters: z.object({ topic: z.string() }),
        execute: async ({ topic }) => {
          const { text } = await generateText({
            model: openai('gpt-4o-mini'),
            system: '–¢–∏ ‚Äî –¥–æ—Å–ª—ñ–¥–Ω–∏–∫. –ó–Ω–∞–π–¥–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —ñ –ø–æ–≤–µ—Ä–Ω–∏ —Å—Ç–∏—Å–ª–∏–π –∑–≤—ñ—Ç (–º–∞–∫—Å 500 —Å–ª—ñ–≤).',
            prompt: topic,
            tools: { webSearch, documentSearch },
            maxSteps: 5,
          });
          return text; // –¢—ñ–ª—å–∫–∏ –†–ï–ó–£–õ–¨–¢–ê–¢ –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç lead agent
        },
      }),
      
      // Sub-agent –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É ‚Äî –º–∞—î –°–í–Ü–ô –∫–æ–Ω—Ç–µ–∫—Å—Ç
      analysisAgent: tool({
        description: '–ê–Ω–∞–ª—ñ–∑—É—î –¥–∞–Ω—ñ —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –≤–∏—Å–Ω–æ–≤–∫–∏.',
        parameters: z.object({ data: z.string(), question: z.string() }),
        execute: async ({ data, question }) => {
          const { text } = await generateText({
            model: openai('gpt-4o'),
            system: '–¢–∏ ‚Äî –∞–Ω–∞–ª—ñ—Ç–∏–∫. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –¥–∞–Ω—ñ —ñ –¥–∞–π —á—ñ—Ç–∫—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å.',
            prompt: `–î–∞–Ω—ñ:\n${data}\n\n–ü–∏—Ç–∞–Ω–Ω—è: ${question}`,
          });
          return text;
        },
      }),
    },
    maxSteps: 10,
  });
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:** –î–µ—Ç–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—à—É–∫—É (–¥–µ—Å—è—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤) –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–º –≤ sub-agent. Lead agent –æ—Ç—Ä–∏–º—É—î —Ç—ñ–ª—å–∫–∏ —Å—Ç–∏—Å–ª–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

---

## Context Engineering Checklist

### –î–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É

- [ ] –í–∏–∑–Ω–∞—á–∏—Ç–∏ context budget (—Å–∫—ñ–ª—å–∫–∏ —Ç–æ–∫–µ–Ω—ñ–≤ –Ω–∞ –∫–æ–∂–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
- [ ] –ù–∞–ø–∏—Å–∞—Ç–∏ system prompt –∑ —á—ñ—Ç–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —ñ few-shot –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏
- [ ] –°–ø—Ä–æ–µ–∫—Ç—É–≤–∞—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –Ω–∞–±—ñ—Ä tools –∑ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–∏–º–∏ –æ–ø–∏—Å–∞–º–∏
- [ ] –í–∏–∑–Ω–∞—á–∏—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é RAG (static / dynamic / just-in-time)
- [ ] –û–±—Ä–∞—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é history management (window / summarize / notes)
- [ ] –ü–µ—Ä–µ–¥–±–∞—á–∏—Ç–∏ compaction –¥–ª—è –¥–æ–≤–≥–∏—Ö –≤–∑–∞—î–º–æ–¥—ñ–π
- [ ] –í–∫–ª—é—á–∏—Ç–∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ (—â–æ –ù–ï —Ä–æ–±–∏—Ç–∏)

### –î–ª—è –¥–µ–±–∞–≥—É —è–∫–æ—Å—Ç—ñ

- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç (–ª–æ–≥—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–∏–π prompt)
- [ ] –ß–∏ –Ω–µ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–∏–π token budget?
- [ ] –ß–∏ –Ω–µ–º–∞—î —Å—É–ø–µ—Ä–µ—á–ª–∏–≤–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π –≤ system prompt?
- [ ] –ß–∏ tool descriptions –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ñ? (—Ç–µ—Å—Ç: —á–∏ –í–ò –∑–∞–≤–∂–¥–∏ –∑–Ω–∞—î—Ç–µ —è–∫–∏–π tool –æ–±—Ä–∞—Ç–∏?)
- [ ] –ß–∏ RAG –ø–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ chunks? (–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ retrieval quality)
- [ ] –ß–∏ history –Ω–µ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–∞ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏–º–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏?

### –î–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –≤–∞—Ä—Ç–æ—Å—Ç—ñ

- [ ] –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–µ—à–µ–≤—É –º–æ–¥–µ–ª—å –¥–ª—è compaction —Ç–∞ summarization
- [ ] –û–±–º–µ–∂–∏—Ç–∏ tool output size (–Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ –∑–∞–π–≤—ñ –ø–æ–ª—è)
- [ ] –ö–µ—à—É–≤–∞—Ç–∏ system prompt (prompt caching Anthropic/OpenAI)
- [ ] –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ just-in-time –∑–∞–º—ñ—Å—Ç—å pre-loading –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö

---

## –ü–æ–≤'—è–∑–∞–Ω–µ

- **–ö—É—Ä—Å:** [–ü—Ä–æ–º–ø—Ç-—ñ–Ω–∂–µ–Ω–µ—Ä—ñ—è](../../course/04-prompting.md) ‚Äî —Ç–µ—Ö–Ω—ñ–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –ø—Ä–æ–º–ø—Ç—ñ–≤ (–ø—ñ–¥—Ä–æ–∑–¥—ñ–ª context engineering)
- **–ö—É—Ä—Å:** [RAG](../../course/10-rag.md) ‚Äî –ø—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –¥–∞–Ω–∏—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- **–ö—É—Ä—Å:** [–ü–∞–º'—è—Ç—å –∞–≥–µ–Ω—Ç—ñ–≤](../../course/09-memory.md) ‚Äî –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –º—ñ–∂ —Å–µ—Å—ñ—è–º–∏
- **–ö—É—Ä—Å:** [MCP](../../course/11-mcp.md) ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è tools
- **KB:** [Agentic RAG](../rag/agentic-rag.md) ‚Äî —Ä–æ–∑—É–º–Ω–∏–π –ø–æ—à—É–∫ —è–∫ —á–∞—Å—Ç–∏–Ω–∞ context pipeline
- **KB:** [Multi-agent](../agents/multi-agent.md) ‚Äî —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –º—ñ–∂ –∞–≥–µ–Ω—Ç–∞–º–∏
- **KB:** [Long-running agents](../agents/long-running.md) ‚Äî compaction –¥–ª—è –¥–æ–≤–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤

## –î–∂–µ—Ä–µ–ª–∞

- [Anthropic ‚Äî Effective context engineering for AI agents](https://www.anthropic.com/engineering/effective-context-engineering-for-ai-agents) (–≤–µ—Ä–µ—Å–µ–Ω—å 2025)
- [Anthropic ‚Äî Effective harnesses for long-running agents](https://www.anthropic.com/engineering/effective-harnesses-for-long-running-agents)
- [12 Factor Agents ‚Äî Dex Horthy](https://github.com/humanlayer/12-factor-agents)
- [Context Engineering Guide ‚Äî PromptingGuide.ai](https://www.promptingguide.ai/guides/context-engineering-guide)
- [Gartner ‚Äî Context engineering for Enterprise AI](https://www.gartner.com/en/articles/context-engineering)
- [LangChain ‚Äî State of Agent Engineering 2025](https://blog.langchain.dev/)
