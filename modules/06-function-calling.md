# –ú–æ–¥—É–ª—å 06: Function Calling ‚Äî LLM —è–∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä –¥—ñ–π

## üéØ –©–æ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –∑ —Ü—å–æ–≥–æ –º–æ–¥—É–ª—è

–ü—ñ—Å–ª—è –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –≤–∏ –±—É–¥–µ—Ç–µ:
- –†–æ–∑—É–º—ñ—Ç–∏ —â–æ —Ç–∞–∫–µ Function Calling (Tool Use) —Ç–∞ —è–∫ LLM "–≤–∏–∫–ª–∏–∫–∞—î" –≤–∞—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
- –°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ tools –∑ Zod-—Å—Ö–µ–º–∞–º–∏ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
- –û–±—Ä–æ–±–ª—è—Ç–∏ –æ–¥–∏–Ω–∏—á–Ω—ñ —Ç–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –≤–∏–∫–ª–∏–∫–∏
- –ë—É–¥—É–≤–∞—Ç–∏ multi-step –ª–∞–Ω—Ü—é–∂–∫–∏: LLM ‚Üí tool ‚Üí LLM ‚Üí tool ‚Üí ...

**–Ø–∫—ñ –∑–∞–¥–∞—á—ñ —Ü–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∏—Ä—ñ—à—É–≤–∞—Ç–∏:** –¶–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è AI-–∞–≥–µ–Ω—Ç—ñ–≤. LLM –æ—Ç—Ä–∏–º—É—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑—ñ —Å–≤—ñ—Ç–æ–º: –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—å –¥–æ API, —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏ –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö, –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ email, –∫–µ—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é ‚Äî –≤—Å–µ —á–µ—Ä–µ–∑ –≤–∞—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó.

---

## 6.1 –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è: –Ø–∫ LLM "–≤–∏–∫–ª–∏–∫–∞—î" —Ñ—É–Ω–∫—Ü—ñ—ó

LLM **–Ω–µ –º–æ–∂–µ** –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥. –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –ø—Ä–∞—Ü—é—î —Ç–∞–∫–∏–π –ø–æ—Ç—ñ–∫:

```
1. –í–∏ –æ–ø–∏—Å—É—î—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ (tools) ‚Üí LLM
2. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–¥–∞—î –ø–∏—Ç–∞–Ω–Ω—è ‚Üí LLM
3. LLM –í–ò–†–Ü–®–£–Ñ: "–¥–ª—è —Ü—å–æ–≥–æ –ø–∏—Ç–∞–Ω–Ω—è –º–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–µ–Ω tool X –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ Y"
4. LLM –ø–æ–≤–µ—Ä—Ç–∞—î –í–ê–ú: { tool: "X", args: { Y } }
5. –í–ê–® –ö–û–î –≤–∏–∫–æ–Ω—É—î —Ñ—É–Ω–∫—Ü—ñ—é X(Y) ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç
6. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –Ω–∞–∑–∞–¥ ‚Üí LLM
7. LLM —Ñ–æ—Ä–º—É—î —Ñ—ñ–Ω–∞–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
```

```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: "–Ø–∫–∞ –∑–∞—Ä–∞–∑ –ø–æ–≥–æ–¥–∞ –≤ –ö–∏—î–≤—ñ?"

–í–∞—à –∫–æ–¥ ‚Üí LLM: "–£ —Ç–µ–±–µ —î tool getWeather(city)"
LLM ‚Üí –í–∞—à –∫–æ–¥: "–í–∏–∫–ª–∏–∫–∞–π getWeather({ city: 'Kyiv' })"
–í–∞—à –∫–æ–¥: getWeather('Kyiv') ‚Üí { temp: 5, condition: 'cloudy' }
–í–∞—à –∫–æ–¥ ‚Üí LLM: "–†–µ–∑—É–ª—å—Ç–∞—Ç: { temp: 5, condition: 'cloudy' }"
LLM ‚Üí –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: "–ó–∞—Ä–∞–∑ —É –ö–∏—î–≤—ñ 5¬∞C, —Ö–º–∞—Ä–Ω–æ."
```

**–ö–ª—é—á–æ–≤–∏–π –º–æ–º–µ–Ω—Ç:** LLM –æ–±–∏—Ä–∞—î –Ø–ö–ò–ô —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —ñ –∑ –Ø–ö–ò–ú–ò –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –í–∞—à –∫–æ–¥ –≤–∏–∫–æ–Ω—É—î —Å–∞–º—É –¥—ñ—é.

---

## 6.2 –ë–∞–∑–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥ –∑ AI SDK

```typescript
import { generateText, tool } from 'ai';
import { openai } from '@ai-sdk/openai';
import { z } from 'zod';

const { text, toolCalls, toolResults } = await generateText({
  model: openai('gpt-4o-mini'),
  tools: {
    // –í–∏–∑–Ω–∞—á–∞—î–º–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
    getWeather: tool({
      description: '–û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –ø–æ–≥–æ–¥—É –¥–ª—è –º—ñ—Å—Ç–∞',
      parameters: z.object({
        city: z.string().describe('–ù–∞–∑–≤–∞ –º—ñ—Å—Ç–∞'),
        units: z.enum(['celsius', 'fahrenheit']).default('celsius'),
      }),
      // execute ‚Äî –≤–∞—à –∫–æ–¥ —è–∫–∏–π —Ä–µ–∞–ª—å–Ω–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è
      execute: async ({ city, units }) => {
        // –¢—É—Ç –±—É–≤ –±–∏ —Ä–µ–∞–ª—å–Ω–∏–π API –≤–∏–∫–ª–∏–∫
        const response = await fetch(
          `https://api.weather.com/current?city=${city}&units=${units}`
        );
        return response.json();
      },
    }),
  },
  prompt: '–Ø–∫–∞ –∑–∞—Ä–∞–∑ –ø–æ–≥–æ–¥–∞ –≤ –ö–∏—î–≤—ñ?',
  maxSteps: 3, // –î–æ–∑–≤–æ–ª–∏—Ç–∏ –¥–æ 3 –∫—Ä–æ–∫—ñ–≤ (LLM ‚Üí tool ‚Üí LLM)
});

console.log(text);
// "–ó–∞—Ä–∞–∑ —É –ö–∏—î–≤—ñ 5¬∞C, —Ö–º–∞—Ä–Ω–æ, –≤–æ–ª–æ–≥—ñ—Å—Ç—å 78%."
```

### –†–æ–∑–±—ñ—Ä –∫–ª—é—á–æ–≤–∏—Ö —á–∞—Å—Ç–∏–Ω

```typescript
tool({
  description: string,    // –ö–†–ò–¢–ò–ß–ù–û ‚Äî LLM –æ–±–∏—Ä–∞—î tool –Ω–∞ –æ—Å–Ω–æ–≤—ñ –æ–ø–∏—Å—É
  parameters: ZodSchema,  // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —è–∫—ñ LLM –∑–∞–ø–æ–≤–Ω–∏—Ç—å
  execute: async (args) => result,  // –í–∞—à –∫–æ–¥
})
```

**`description`** ‚Äî —Ü–µ –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM. –Ø–∫—â–æ –æ–ø–∏—Å –ø–æ–≥–∞–Ω–∏–π, –º–æ–¥–µ–ª—å –Ω–µ –∑—Ä–æ–∑—É–º—ñ—î –∫–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ tool.

**`parameters`** ‚Äî Zod-—Å—Ö–µ–º–∞. LLM –≥–µ–Ω–µ—Ä—É—î –∞—Ä–≥—É–º–µ–Ω—Ç–∏, AI SDK –≤–∞–ª—ñ–¥—É—î —ó—Ö.

**`maxSteps`** ‚Äî —Å–∫—ñ–ª—å–∫–∏ —Ü–∏–∫–ª—ñ–≤ tool call ‚Üí result –¥–æ–∑–≤–æ–ª–µ–Ω–æ. –ë–µ–∑ —Ü—å–æ–≥–æ ‚Äî –ª–∏—à–µ –æ–¥–∏–Ω –∫—Ä–æ–∫.

---

## 6.3 –ö—ñ–ª—å–∫–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ

```typescript
const { text } = await generateText({
  model: openai('gpt-4o-mini'),
  tools: {
    searchProducts: tool({
      description: '–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—ñ–≤ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ –∑–∞ –∑–∞–ø–∏—Ç–æ–º',
      parameters: z.object({
        query: z.string(),
        maxResults: z.number().default(5),
        category: z.enum(['electronics', 'clothing', 'books', 'all']).default('all'),
      }),
      execute: async ({ query, maxResults, category }) => {
        return db.products.search({ query, limit: maxResults, category });
      },
    }),

    getProductDetails: tool({
      description: '–û—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç–æ–≤–∞—Ä –∑–∞ ID',
      parameters: z.object({
        productId: z.string(),
      }),
      execute: async ({ productId }) => {
        return db.products.findById(productId);
      },
    }),

    addToCart: tool({
      description: '–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä –¥–æ –∫–æ—à–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞',
      parameters: z.object({
        productId: z.string(),
        quantity: z.number().min(1).default(1),
      }),
      execute: async ({ productId, quantity }) => {
        return cart.add(userId, productId, quantity);
      },
    }),
  },

  maxSteps: 5,
  prompt: '–ó–Ω–∞–π–¥–∏ –±–µ–∑–¥—Ä–æ—Ç–æ–≤—ñ –Ω–∞–≤—É—à–Ω–∏–∫–∏ –¥–æ 2000 –≥—Ä–Ω —ñ –¥–æ–¥–∞–π –Ω–∞–π–∫—Ä–∞—â—ñ –≤ –∫–æ—à–∏–∫',
});

// LLM –∑—Ä–æ–±–∏—Ç—å –∫—ñ–ª—å–∫–∞ –∫—Ä–æ–∫—ñ–≤:
// 1. searchProducts({ query: "–±–µ–∑–¥—Ä–æ—Ç–æ–≤—ñ –Ω–∞–≤—É—à–Ω–∏–∫–∏", category: "electronics" })
// 2. getProductDetails({ productId: "best-match-id" })
// 3. addToCart({ productId: "best-match-id", quantity: 1 })
// 4. –°—Ñ–æ—Ä–º—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
```

---

## 6.4 –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —É Tools

```typescript
const safeDbQuery = tool({
  description: '–í–∏–∫–æ–Ω–∞—Ç–∏ SQL-–∑–∞–ø–∏—Ç –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö',
  parameters: z.object({
    query: z.string().describe('SELECT –∑–∞–ø–∏—Ç (—Ç—ñ–ª—å–∫–∏ —á–∏—Ç–∞–Ω–Ω—è)'),
  }),
  execute: async ({ query }) => {
    // –í–∞–ª—ñ–¥–∞—Ü—ñ—è: –∑–∞–±–æ—Ä–æ–Ω—è—î–º–æ –Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
    if (/\b(INSERT|UPDATE|DELETE|DROP|ALTER)\b/i.test(query)) {
      return { error: '–¢—ñ–ª—å–∫–∏ SELECT –∑–∞–ø–∏—Ç–∏ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ', success: false };
    }

    try {
      const result = await db.query(query);
      return { data: result.rows, rowCount: result.rowCount, success: true };
    } catch (error) {
      // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ–º–∏–ª–∫—É —è–∫ –¥–∞–Ω—ñ, –∞ –Ω–µ –∫–∏–¥–∞—î–º–æ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è
      // LLM –ø–æ–±–∞—á–∏—Ç—å –ø–æ–º–∏–ª–∫—É —ñ –º–æ–∂–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª—é–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç
      return { error: error.message, success: false };
    }
  },
});
```

**–í–∞–∂–ª–∏–≤–æ:** –ü–æ–≤–µ—Ä—Ç–∞–π—Ç–µ –ø–æ–º–∏–ª–∫–∏ —è–∫ –¥–∞–Ω—ñ (`{ error: "..." }`), –∞ –Ω–µ –∫–∏–¥–∞–π—Ç–µ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è. –¶–µ –¥–æ–∑–≤–æ–ª—è—î LLM –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É —ñ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ñ–Ω—à–∏–π –ø—ñ–¥—Ö—ñ–¥.

---

## 6.5 –ü–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –≤–∏–∫–ª–∏–∫–∏

–î–µ—è–∫—ñ –º–æ–¥–µ–ª—ñ –º–æ–∂—É—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ tools –æ–¥–Ω–æ—á–∞—Å–Ω–æ:

```typescript
// –ó–∞–ø–∏—Ç: "–Ø–∫–∞ –ø–æ–≥–æ–¥–∞ –≤ –ö–∏—î–≤—ñ —Ç–∞ –õ—å–≤–æ–≤—ñ?"
// LLM –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –û–î–ù–û–ß–ê–°–ù–û:
// - getWeather({ city: "Kyiv" })
// - getWeather({ city: "Lviv" })
// AI SDK –≤–∏–∫–æ–Ω–∞—î –æ–±–∏–¥–≤–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ —ñ –ø–æ–≤–µ—Ä–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–∞–∑–æ–º
```

–¶–µ –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ ‚Äî AI SDK –≤–∏–∫–æ–Ω—É—î –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.

---

## 6.6 Tool –±–µ–∑ execute (Human-in-the-Loop)

–Ü–Ω–æ–¥—ñ –≤–∏ —Ö–æ—á–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è LLM, –∞–ª–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥—ñ—é –≤—Ä—É—á–Ω—É:

```typescript
const { toolCalls } = await generateText({
  model: openai('gpt-4o-mini'),
  tools: {
    sendEmail: tool({
      description: '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ email –∫–ª—ñ—î–Ω—Ç—É',
      parameters: z.object({
        to: z.string().email(),
        subject: z.string(),
        body: z.string(),
      }),
      // –ë–ï–ó execute ‚Äî tool call –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –≤–∞–º –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
    }),
  },
  prompt: '–í—ñ–¥–ø—Ä–∞–≤ –∫–ª—ñ—î–Ω—Ç—É oleg@test.com –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è #123',
});

// toolCalls[0] = { toolName: 'sendEmail', args: { to: 'oleg@test.com', subject: '...', body: '...' } }
// –¢–µ–ø–µ—Ä –í–ò –≤–∏—Ä—ñ—à—É—î—Ç–µ ‚Äî –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ —á–∏ –Ω—ñ
if (await userConfirms(toolCalls[0])) {
  await sendEmail(toolCalls[0].args);
}
```

---

## –ü–µ—Ä–µ–≤—ñ—Ä —Å–µ–±–µ

1. –ü–æ—è—Å–Ω—ñ—Ç—å –ø–æ—Ç—ñ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è Function Call: —Ö—Ç–æ —â–æ —Ä–æ–±–∏—Ç—å –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ?
2. –ß–æ–º—É `description` —É tool ‚Äî —Ü–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ?
3. –ù–∞–ø–∏—à—ñ—Ç—å tool –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –≤–∞–ª—é—Ç (USD, EUR, UAH)
4. –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ–º–∏–ª–∫–∏ –≤ execute? –ß–æ–º—É –Ω–µ throw?
5. –©–æ —Ç–∞–∫–µ `maxSteps` —ñ —á–æ–º—É –π–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±–º–µ–∂—É–≤–∞—Ç–∏?

---

**–ù–∞–∑–∞–¥:** [‚Üê –ú–æ–¥—É–ª—å 05 ‚Äî Structured Output](05-structured-output.md) | **–î–∞–ª—ñ:** [–ú–æ–¥—É–ª—å 07 ‚Äî –°—Ç—Ä—ñ–º—ñ–Ω–≥ —Ç–∞ UI ‚Üí](07-streaming.md)
